<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MNAU</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="MNAU_files/libs/clipboard/clipboard.min.js"></script>
<script src="MNAU_files/libs/quarto-html/quarto.js"></script>
<script src="MNAU_files/libs/quarto-html/popper.min.js"></script>
<script src="MNAU_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="MNAU_files/libs/quarto-html/anchor.min.js"></script>
<link href="MNAU_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="MNAU_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="MNAU_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="MNAU_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="MNAU_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="MNAU_files/libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="MNAU_files/libs/plotly-binding-4.10.3/plotly.js"></script>
<script src="MNAU_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="MNAU_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="MNAU_files/libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="MNAU_files/libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="MNAU_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="MNAU_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MNAU</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="import-packages" class="level3">
<h3 class="anchored" data-anchor-id="import-packages">Import packages</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../INPUT/FUNCTIONS/preprocess.R"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scatterplot3d)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="mnau---used" class="level1">
<h1>%MNAU - Used</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../Input/DATA/Summary_Dataset_Used_Percentage_MNAU.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data_multi <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'../Input/DATA/Summary_Dataset_Multivar_Percentage_MNAU.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">preprocess</span>(data)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>data_multi <span class="ot">=</span> <span class="fu">preprocess</span>(data_multi)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 16
Columns: 26
$ Type                                  &lt;chr&gt; "Primary hominin interment", "Pr…
$ AccumulationType                      &lt;chr&gt; "Burial", "Burial", "Burial", "C…
$ Individuals                           &lt;int&gt; 49, 84, 6, 7, 6, 2, 5, 43, 13, 1…
$ Cranium                               &lt;dbl&gt; 0.7755102, 0.8095238, 0.8333333,…
$ Mandible                              &lt;dbl&gt; 0.6938776, 0.7619048, 0.8333333,…
$ Cervical                              &lt;dbl&gt; 0.74052478, 0.48979592, 0.166666…
$ Thoracic                              &lt;dbl&gt; 0.76870748, 0.52976190, 0.333333…
$ Lumbar                                &lt;dbl&gt; 0.78775510, 0.60000000, 0.400000…
$ Sacrum                                &lt;dbl&gt; 0.79591837, 0.61904762, 0.500000…
$ Sternum                               &lt;dbl&gt; 0.00000000, 0.00000000, 0.333333…
$ Clavicle                              &lt;dbl&gt; 0.82653061, 0.61309524, 0.500000…
$ Rib                                   &lt;dbl&gt; 0.76615646, 0.49255952, 0.229166…
$ Scapula                               &lt;dbl&gt; 0.7959184, 0.6250000, 0.3333333,…
$ Humerus                               &lt;dbl&gt; 0.7448980, 0.7678571, 0.7500000,…
$ Radius                                &lt;dbl&gt; 0.78571429, 0.72023810, 0.666666…
$ Ulna                                  &lt;dbl&gt; 0.75510204, 0.64880952, 0.750000…
$ Carpal                                &lt;dbl&gt; 0.663265306, 0.288690476, 0.2291…
$ Innominate                            &lt;dbl&gt; 0.78571429, 0.71428571, 0.583333…
$ Femur                                 &lt;dbl&gt; 0.8775510, 0.7916667, 0.6666667,…
$ Patella                               &lt;dbl&gt; 0.6938776, 0.4583333, 0.1666667,…
$ Tibia                                 &lt;dbl&gt; 0.6734694, 0.7202381, 0.7500000,…
$ Fibula                                &lt;dbl&gt; 0.6938776, 0.6190476, 0.5833333,…
$ Tarsal                                &lt;dbl&gt; 0.63265306, 0.48639456, 0.261904…
$ Hand..metacarpals...manual.phalanges. &lt;dbl&gt; 0.658968851, 0.373746867, 0.1535…
$ Foot..metatarsals...pedal.phalanges.  &lt;dbl&gt; 0.436627282, 0.272869674, 0.1271…
$ Cluster_Pnas                          &lt;chr&gt; "A", "A", "B", "C", "C", "C", "C…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Pottery_Mound_Pueblo_IV"      "Kuaua_Pueblo_Pueblo_IV"      
 [3] "Skhul_Layer_B"                "Fontbregoua_H1"              
 [5] "Fontbregoua_H3"               "Gran_Dolina_TD6"             
 [7] "El_Mirador_MIR4A"             "Krapina"                     
 [9] "AL_333"                       "Unscavenged_human_corpses_WA"
[11] "Scavenged_human_corpses_WA"   "Mapungubwe_leopard_kills"    
[13] "Leopard_refuse"               "Misgrot_Cave"                
[15] "Sima_de_los_Huesos"           "Dinaledi"                    </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the columns for which you want to count the labels</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>columns_to_count <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to count labels in each specified column</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>count_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(data, columns) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(data[columns], <span class="cf">function</span>(column) <span class="fu">table</span>(column))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the function to count labels</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>label_counts <span class="ot">&lt;-</span> <span class="fu">count_labels</span>(data, columns_to_count)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the counts</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>label_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Type
column
Hominin cannibalism/ secondary interment 
                                       5 
                          Leopard refuse 
                                       2 
             Natural Baboon accumulation 
                                       1 
   Nonanthropogenic hominin accumulation 
                                       1 
    Possible hominin deliberate disposal 
                                       2 
      Possible Primary hominin interment 
                                       1 
               Primary hominin interment 
                                       2 
                 Scavenged human corpses 
                                       1 
               Unscavenged human corpses 
                                       1 

$AccumulationType
column
                               Burial                Cannibalism/Mass Grave 
                                    5                                     5 
               Carnivore intervention Non-human/ non-carnivore intervention 
                                    3                                     3 

$Individuals
column
 2  5  6  7  8 13 17 18 43 45 49 84 
 1  1  2  3  1  2  1  1  1  1  1  1 

$Cluster_Pnas
column
A B C D 
3 3 6 4 </code></pre>
</div>
</div>
<section id="take-sh-out-of-the-training-set-to-avoid-data-leakage" class="level3">
<h3 class="anchored" data-anchor-id="take-sh-out-of-the-training-set-to-avoid-data-leakage">Take SH out of the training set (to avoid data leakage)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">split_train_SH</span>(data)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> split<span class="sc">$</span>train_data</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>sh <span class="ot">&lt;-</span> split<span class="sc">$</span>sh_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="center-and-scale-numeric-data" class="level3">
<h3 class="anchored" data-anchor-id="center-and-scale-numeric-data">Center and scale numeric data</h3>
<p>Normalize numeric data to have a standard deviation of one and a mean of zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store original row names of the datasets</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data_row_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sh_row_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sh)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create a recipe</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(<span class="sc">~</span> ., <span class="at">data =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>)))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Fit the recipe to the training set</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>fitted_recipe <span class="ot">&lt;-</span> <span class="fu">prep</span>(recipe, <span class="at">training =</span> data)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Apply the transformation to both training and test sets</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>data_transformed <span class="ot">&lt;-</span> <span class="fu">bake</span>(fitted_recipe, <span class="at">new_data =</span> data)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>sh_transformed <span class="ot">&lt;-</span> <span class="fu">bake</span>(fitted_recipe, <span class="at">new_data =</span> sh)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reattach the row names</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_transformed) <span class="ot">&lt;-</span> data_row_names</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sh_transformed) <span class="ot">&lt;-</span> sh_row_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-selection" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection">Feature selection</h3>
<p><strong>In Pnas RF with labels has been used (!data leakage).</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure reproducibility</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the label and features</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> data<span class="sc">$</span>Type</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>data_rf_sup <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>))</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'Type' to a factor</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>Type)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the RandomForest model</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>rf_model_sup <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> data_rf_sup, <span class="at">y =</span> label, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the feature importance</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>feature_importance_ <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_sup)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the feature importance</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>feature_importance_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)][]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      MeanDecreaseAccuracy MeanDecreaseGini
Cranium                                          2.6450815        0.3925055
Mandible                                        -0.5848239        0.4020929
Cervical                                         0.7241395        0.4715153
Thoracic                                         2.1384554        0.4792270
Lumbar                                           0.5352871        0.4397056
Sacrum                                           2.9055546        0.3978595
Sternum                                          1.4874660        0.3356596
Clavicle                                         1.3749003        0.7051434
Rib                                              1.3763413        0.5330900
Scapula                                          1.7182627        0.3604157
Humerus                                          2.9870490        0.5914351
Radius                                          -0.6440809        0.4776309
Ulna                                             0.7378602        0.3554231
Carpal                                           4.6985887        0.6754343
Innominate                                       4.6840445        0.6086924
Femur                                            4.4059527        0.7150569
Patella                                          0.3310926        0.3090530
Tibia                                            1.2701655        0.5279150
Fibula                                           2.5274423        0.5567144
Tarsal                                           6.1502032        0.8700476
Hand..metacarpals...manual.phalanges.            6.4488931        0.7742747
Foot..metatarsals...pedal.phalanges.             2.9254873        0.6739081</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting MeanDecreaseAccuracy </span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>mean_decrease_accuracy <span class="ot">&lt;-</span> feature_importance_[, <span class="st">"MeanDecreaseAccuracy"</span>]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter features where MeanDecreaseAccuracy is greater than 5</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>important_features_ <span class="ot">&lt;-</span> feature_importance_[mean_decrease_accuracy <span class="sc">&gt;</span> <span class="fl">3.4</span>, ]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the important features</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      MeanDecreaseAccuracy MeanDecreaseGini
Carpal                                            4.698589        0.6754343
Innominate                                        4.684045        0.6086924
Femur                                             4.405953        0.7150569
Tarsal                                            6.150203        0.8700476
Hand..metacarpals...manual.phalanges.             6.448893        0.7742747</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save top 7 features</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>columns_rf_sup<span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">as.data.frame</span>(important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)]))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>columns_rf_sup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Carpal"                               
[2] "Innominate"                           
[3] "Femur"                                
[4] "Tarsal"                               
[5] "Hand..metacarpals...manual.phalanges."</code></pre>
</div>
</div>
<p><strong>Random Forrest feature importance with self-label (without data leakage)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>data_rf <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create artificial labels where each row is its own class</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>artificial_labels <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data_rf))</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the data with the artificial labels</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>data_with_labels <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data_rf, artificial_labels)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(artificial_labels <span class="sc">~</span> ., <span class="at">data =</span> data_with_labels, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract feature importance based on Mean Decrease in Gini</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model) <span class="co"># type = 1 for %IncMSE </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          %IncMSE IncNodePurity
Cranium                                3.07896587     14.709428
Mandible                               0.53003972      8.280381
Cervical                              -0.30101111      7.981971
Thoracic                               2.94487912      8.185263
Lumbar                                 0.70576621      8.060364
Sacrum                                 0.73057831      4.140110
Sternum                                1.66472991     18.249388
Clavicle                               3.44206626     32.616016
Rib                                    0.91958708      5.002329
Scapula                               -0.23365134      5.660383
Humerus                               -0.68487319      8.356400
Radius                                -0.02810234      6.771984
Ulna                                  -1.24039461      6.238966
Carpal                                 2.86021142     15.220026
Innominate                             2.49094726      4.478900
Femur                                  1.72176956     11.771362
Patella                                0.91218927      8.128162
Tibia                                  0.37266590      8.673266
Fibula                                 0.31578101      6.310714
Tarsal                                 3.34023902     19.760044
Hand..metacarpals...manual.phalanges.  3.09650809     19.201943
Foot..metatarsals...pedal.phalanges.   2.96441420     15.019968</code></pre>
</div>
</div>
<p>We are going to use <code>names(featrue_importance[feature_importance &gt; 2])</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting MeanDecreaseAccuracy </span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>mean_decrease_accuracy <span class="ot">&lt;-</span> feature_importance[,<span class="st">"%IncMSE"</span>]</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter features where MeanDecreaseAccuracy is greater than 5</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>important_features_ <span class="ot">&lt;-</span> feature_importance_[mean_decrease_accuracy <span class="sc">&gt;</span> <span class="dv">2</span>, ]</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the important features</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>columns_rf <span class="ot">&lt;-</span> <span class="fu">rownames</span>(important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)])</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>columns_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Cranium"                              
[2] "Thoracic"                             
[3] "Clavicle"                             
[4] "Carpal"                               
[5] "Innominate"                           
[6] "Tarsal"                               
[7] "Hand..metacarpals...manual.phalanges."
[8] "Foot..metatarsals...pedal.phalanges." </code></pre>
</div>
</div>
<p><strong>Unsupervised Feature Selection with Random Forests (UFSRF)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SHAP</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Feature correlation heatmap</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_plot_cor <span class="ot">=</span> <span class="fu">abbreviated_columns</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_plot_cor[<span class="fu">sapply</span>(data_plot_cor, is.numeric)], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>melted_cor_matrix <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_matrix)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted_cor_matrix, <span class="fu">aes</span>(Var1, Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + # Rotate x-axis labels</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_minimal() +</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlation Matrix"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="co">#correlation matrix</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">method =</span> <span class="st">"color"</span>, <span class="co">#show coloured blocks</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">is.corr =</span> <span class="cn">TRUE</span>, <span class="co">#input matrix is a correlation matrix</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"upper"</span>, <span class="co">#show only upper diagonal of correlogram</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"AOE"</span>, <span class="co">#Hierarchical clustering order</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hclust.method =</span> <span class="st">"average"</span>, <span class="co">#using the average linkage distance measure</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="co">#show numerical value of coefficient</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co">#text color of data label</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of data label</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rect.lwd =</span> <span class="dv">3</span>,<span class="co">#text size of data label</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.srt =</span> <span class="dv">90</span>, <span class="co">#text rotation of data label</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="co">#text size of color-legend label</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of correlation coefficient</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="co">#hide coefficient on the principal diagonal</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="co">#correlation matrix</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">method =</span> <span class="st">"color"</span>, <span class="co">#show coloured blocks</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">is.corr =</span> <span class="cn">TRUE</span>, <span class="co">#input matrix is a correlation matrix</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"upper"</span>, <span class="co">#show only upper diagonal of correlogram</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="co">#Hierarchical clustering order</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hclust.method =</span> <span class="st">"average"</span>, <span class="co">#using the average linkage distance measure</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="co">#show numerical value of coefficient</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co">#text color of data label</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of data label</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rect.lwd =</span> <span class="dv">3</span>,<span class="co">#text size of data label</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.srt =</span> <span class="dv">90</span>, <span class="co">#text rotation of data label</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="co">#text size of color-legend label</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of correlation coefficient</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="co">#hide coefficient on the principal diagonal</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Based on feature correlation and clustering, merge bone subcategories into its categories:</strong></p>
<ul>
<li><p><em>“Vertebra”= {“Cervical”, “Thoracic”, “Lumbar”, “Sacrum”,“Rib”}</em></p></li>
<li><p><em>“Arm” = {“Humerus”, “Radius”, “Ulna”}</em></p></li>
<li><p><em>“Leg” = {“Femur”, “Tibia”, “Fibula” }</em></p></li>
<li><p><em>“Extremities”: {“Carpal”, “Tarsal</em>”, “Hand..metacarpals…manual.phalanges.”, “Foot..metatarsals…pedal.phal</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Define data_cor data set</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>data_cor <span class="ot">=</span> <span class="fu">merge_bone_cat_by_mean</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Define list of data sets to work with:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data, data[columns_rf_sup] , data[columns_rf], data_cor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dimension-reduction" class="level3">
<h3 class="anchored" data-anchor-id="dimension-reduction">Dimension Reduction</h3>
<p><strong>PCA</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>data_pca <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(columns_to_count))</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(data_pca, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>X_pca <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>X_pca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                     PC1         PC2         PC3          PC4
Pottery_Mound_Pueblo_IV       5.61051000  1.87665597 -1.22755981  1.400037477
Kuaua_Pueblo_Pueblo_IV        3.09911892  0.24179942 -0.77431334  1.176076191
Skhul_Layer_B                 1.15887496 -1.14990743 -0.06255997  0.195046104
Fontbregoua_H1               -3.95400466 -0.02701569  1.47536160  0.426595859
Fontbregoua_H3               -3.11786757 -0.61063694 -2.99793937 -1.125218352
Gran_Dolina_TD6              -3.42870363  2.22489835  0.63630773  0.867591624
El_Mirador_MIR4A             -4.10742509 -0.30005566  1.56970907 -0.009944834
Krapina                      -4.13518121  0.72973487 -0.42940008 -0.652451941
AL_333                       -4.42348534  0.55311758 -0.15836880 -0.296612857
Unscavenged_human_corpses_WA  8.30073178  0.80197592  0.77066787 -1.332111535
Scavenged_human_corpses_WA    3.37784341  0.83197084  1.03649953 -1.358202377
Mapungubwe_leopard_kills      2.54486651 -1.95437699  0.38280761 -0.160562651
Leopard_refuse                1.47771591 -2.76309280  0.23867006  1.087919071
Misgrot_Cave                 -0.08226468 -0.69814017 -0.13114599 -0.305345264
Dinaledi                     -2.32072932  0.24307273 -0.32873613  0.087183486
                                     PC5         PC6
Pottery_Mound_Pueblo_IV      -0.91631780 -0.39415535
Kuaua_Pueblo_Pueblo_IV       -0.55507179  0.35613047
Skhul_Layer_B                -0.04574962  1.45002360
Fontbregoua_H1               -0.75117650  0.03343287
Fontbregoua_H3                0.27887479  0.24887731
Gran_Dolina_TD6               1.88065511  0.54591863
El_Mirador_MIR4A             -0.70165881 -0.38898866
Krapina                      -0.28204008 -0.33063753
AL_333                        0.18043564 -0.28023374
Unscavenged_human_corpses_WA  1.17155275 -0.73916109
Scavenged_human_corpses_WA   -1.01566266  0.93407047
Mapungubwe_leopard_kills      0.39095927  0.43238942
Leopard_refuse                0.77824349 -0.55479738
Misgrot_Cave                 -0.61910912 -1.04725279
Dinaledi                      0.20606533 -0.26561623</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot 3D pca</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>df_X_pca <span class="ot">=</span> <span class="fu">as.data.frame</span>(X_pca)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(df_X_pca,<span class="at">x=</span><span class="sc">~</span>PC1,<span class="at">y=</span><span class="sc">~</span>PC2,<span class="at">z=</span><span class="sc">~</span>PC3, <span class="at">color =</span> <span class="sc">~</span>label, <span class="at">type =</span> <span class="st">'scatter3d'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in RColorBrewer::brewer.pal(N, "Set2"): n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors

Warning in RColorBrewer::brewer.pal(N, "Set2"): n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-e1166292214851959837" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-e1166292214851959837">{"x":{"visdat":{"7738729265d1":["function () ","plotlyVisDat"]},"cur_data":"7738729265d1","attrs":{"7738729265d1":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[-3.9540046644025857,-3.1178675702506302,-3.4287036266502291,-4.1074250853484555,-4.1351812101417122],"y":[-0.027015690301208178,-0.61063694131107638,2.2248983455417179,-0.3000556563578235,0.72973486790875031],"z":[1.475361598412628,-2.9979393677540283,0.63630773086593384,1.569709072615292,-0.42940007534794677],"mode":"markers","type":"scatter3d","name":"Hominin cannibalism/ secondary interment","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[2.5448665107443147,1.4777159148630146],"y":[-1.9543769897234398,-2.7630928047930747],"z":[0.38280761463062402,0.23867006426672077],"mode":"markers","type":"scatter3d","name":"Leopard refuse","marker":{"color":"rgba(239,150,106,1)","line":{"color":"rgba(239,150,106,1)"}},"textfont":{"color":"rgba(239,150,106,1)"},"error_y":{"color":"rgba(239,150,106,1)"},"error_x":{"color":"rgba(239,150,106,1)"},"line":{"color":"rgba(239,150,106,1)"},"frame":null},{"x":[-0.082264683031898544],"y":[-0.69814017162120978],"z":[-0.13114598516545423],"mode":"markers","type":"scatter3d","name":"Natural Baboon accumulation","marker":{"color":"rgba(178,156,177,1)","line":{"color":"rgba(178,156,177,1)"}},"textfont":{"color":"rgba(178,156,177,1)"},"error_y":{"color":"rgba(178,156,177,1)"},"error_x":{"color":"rgba(178,156,177,1)"},"line":{"color":"rgba(178,156,177,1)"},"frame":null},{"x":[-4.4234853361221198],"y":[0.55311758308075309],"z":[-0.15836880128006553],"mode":"markers","type":"scatter3d","name":"Nonanthropogenic hominin accumulation","marker":{"color":"rgba(201,148,198,1)","line":{"color":"rgba(201,148,198,1)"}},"textfont":{"color":"rgba(201,148,198,1)"},"error_y":{"color":"rgba(201,148,198,1)"},"error_x":{"color":"rgba(201,148,198,1)"},"line":{"color":"rgba(201,148,198,1)"},"frame":null},{"x":[-2.3207293175328432],"y":[0.24307273325727302],"z":[-0.32873612816736791],"mode":"markers","type":"scatter3d","name":"Possible hominin deliberate disposal","marker":{"color":"rgba(205,180,144,1)","line":{"color":"rgba(205,180,144,1)"}},"textfont":{"color":"rgba(205,180,144,1)"},"error_y":{"color":"rgba(205,180,144,1)"},"error_x":{"color":"rgba(205,180,144,1)"},"line":{"color":"rgba(205,180,144,1)"},"frame":null},{"x":[1.1588749644390555],"y":[-1.1499074260510838],"z":[-0.06255997223558539],"mode":"markers","type":"scatter3d","name":"Possible Primary hominin interment","marker":{"color":"rgba(202,217,72,1)","line":{"color":"rgba(202,217,72,1)"}},"textfont":{"color":"rgba(202,217,72,1)"},"error_y":{"color":"rgba(202,217,72,1)"},"error_x":{"color":"rgba(202,217,72,1)"},"line":{"color":"rgba(202,217,72,1)"},"frame":null},{"x":[5.6105099970537067,3.0991189235610044],"y":[1.8766559696830818,0.24179942006963065],"z":[-1.2275598124644578,-0.77431334047256517],"mode":"markers","type":"scatter3d","name":"Primary hominin interment","marker":{"color":"rgba(250,212,80,1)","line":{"color":"rgba(250,212,80,1)"}},"textfont":{"color":"rgba(250,212,80,1)"},"error_y":{"color":"rgba(250,212,80,1)"},"error_x":{"color":"rgba(250,212,80,1)"},"line":{"color":"rgba(250,212,80,1)"},"frame":null},{"x":[3.3778434069658054],"y":[0.83197083736699051],"z":[1.0364995317528178],"mode":"markers","type":"scatter3d","name":"Scavenged human corpses","marker":{"color":"rgba(223,194,152,1)","line":{"color":"rgba(223,194,152,1)"}},"textfont":{"color":"rgba(223,194,152,1)"},"error_y":{"color":"rgba(223,194,152,1)"},"error_x":{"color":"rgba(223,194,152,1)"},"line":{"color":"rgba(223,194,152,1)"},"frame":null},{"x":[8.3007317758535724],"y":[0.80197592325072109],"z":[0.77066787034345086],"mode":"markers","type":"scatter3d","name":"Unscavenged human corpses","marker":{"color":"rgba(179,179,179,1)","line":{"color":"rgba(179,179,179,1)"}},"textfont":{"color":"rgba(179,179,179,1)"},"error_y":{"color":"rgba(179,179,179,1)"},"error_x":{"color":"rgba(179,179,179,1)"},"line":{"color":"rgba(179,179,179,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(data_pca, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative variance explained by each component</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>var_explained <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Create a scree plot to visualize the variance explained</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(var_explained), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seq_along</span>(var_explained), <span class="at">y =</span> var_explained)) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.95</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Principal Components"</span>) <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative Variance Explained"</span>) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scree Plot Showing Cumulative Variance Explained by PCA Components"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>LDA</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(MASS)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LDA</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_lda &lt;- setdiff(names(data), c("Type","Individuals", "Cluster_Pnas"))</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data_lda &lt;- data[cols_lda]</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_result &lt;- lda(AccumulationType ~ ., data = data_lda)</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">#X_lda &lt;- as.data.frame(predict(lda_result, newdata = data_lda)$x)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 3D scatter </span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_ly(X_lda, x = ~LD1, y = ~LD2, z = ~LD3, color = ~data$AccumulationType, type = 'scatter3d', mode = 'markers')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LDA</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_lda &lt;- setdiff(names(data), c("AccumulationType","Individuals", "Cluster_Pnas"))</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data_lda &lt;- data[cols_lda]</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_result &lt;- lda(Type ~ ., data = data_lda)</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#X_lda &lt;- as.data.frame(predict(lda_result, newdata = data_lda)$x)</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 3D scatter </span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_ly(X_lda, x = ~LD1, y = ~LD2, z = ~LD3, color = ~data$Type, type = 'scatter3d', mode = 'markers')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>amend Dataframe list with X_pca[,c(1:6)] and X_lda</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data, data[, columns_rf_sup], data[, columns_rf], data_cor, X_pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#,X_lda</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="best-k" class="level3">
<h3 class="anchored" data-anchor-id="best-k">Best K</h3>
<p><strong>Ellbow method</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>cols_km <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), <span class="fu">c</span>(<span class="st">"Type"</span>,<span class="st">"AccumulationType"</span>,<span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>data_km <span class="ot">&lt;-</span> data[cols_km]</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 models with 1 to 10 clusters</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>kclusts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(k, <span class="sc">~</span> <span class="fu">kmeans</span>(<span class="at">x =</span> data_km, <span class="at">centers =</span> .x, <span class="at">nstart =</span> <span class="dv">20</span>)),</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">glanced =</span> <span class="fu">map</span>(model, glance)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(glanced))</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View results</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>kclusts<span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> tot.withinss)) <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create plot of number of clusters vs total within sum of squares</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(data_km, kmeans, <span class="at">method =</span> <span class="st">"wss"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Silhouette method</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(data_km, <span class="at">FUN=</span>kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(data_km, <span class="at">FUN =</span> kmeans, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">K.max =</span> <span class="dv">10</span>, <span class="at">B =</span> <span class="dv">50</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modeling" class="level3">
<h3 class="anchored" data-anchor-id="modeling">Modeling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Perform K-means clustering</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_km, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)  </span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The cluster assignments are stored in kmeans_result$cluster</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>sub_grp <span class="ot">&lt;-</span> kmeans_result<span class="sc">$</span>cluster</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the clusters</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(<span class="fu">list</span>(<span class="at">data =</span> data_km, <span class="at">cluster =</span> sub_grp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="eval" class="level3">
<h3 class="anchored" data-anchor-id="eval">Eval</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform K-means clustering on the training set</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>) </span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_km, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign test set points to nearest clusters</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>get_nearest_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(point, centers) {</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">apply</span>(centers, <span class="dv">1</span>, <span class="cf">function</span>(center) <span class="fu">dist</span>(<span class="fu">rbind</span>(center, point)))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">which.min</span>(distances))</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each row in the test set</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>cluster_assignments_test <span class="ot">&lt;-</span> <span class="fu">apply</span>(sh, <span class="dv">1</span>, get_nearest_cluster, <span class="at">centers =</span> kmeans_result<span class="sc">$</span>centers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sh_km <span class="ot">=</span> sh[cols_km] </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the training and test sets for visualization</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_km, sh_km)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>combined_clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(kmeans_result<span class="sc">$</span>cluster, cluster_assignments_test)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize with fviz_cluster</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(<span class="fu">list</span>(<span class="at">data =</span> combined_df, <span class="at">cluster =</span> combined_clusters))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dbscan' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dbscan'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    as.dendrogram</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of dataframes for evaluation</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data_km,data[, columns_rf_sup]</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>                    , data[, columns_rf]</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#, data_cor </span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#,X_lda</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>                    ,X_pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of clusters to evaluate for K-means</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>k_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameters for DBSCAN (example ranges)</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>eps_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>minPts_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for hierarchical clustering</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>hclust_methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ward.D"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"average"</span>)</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># List to store results and best models</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>best_models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">kmeans =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>),</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dbscan =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>),</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">hclust =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>))</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform K-means clustering</span></span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>perform_kmeans <span class="ot">&lt;-</span> <span class="cf">function</span>(data, k, method) {</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">algorithm =</span> method)</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(kmeans_result<span class="sc">$</span>cluster, <span class="fu">dist</span>(data))[, <span class="dv">3</span>])</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> kmeans_result<span class="sc">$</span>cluster, <span class="at">score =</span> silhouette_score))</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform DBSCAN clustering</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>perform_dbscan <span class="ot">&lt;-</span> <span class="cf">function</span>(data, eps, minPts) {</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform DBSCAN clustering</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  dbscan_result <span class="ot">&lt;-</span> dbscan<span class="sc">::</span><span class="fu">dbscan</span>(data, <span class="at">eps =</span> eps, <span class="at">minPts =</span> minPts)</span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude noise points (cluster = 0) from silhouette score calculation</span></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>  valid_clusters <span class="ot">&lt;-</span> dbscan_result<span class="sc">$</span>cluster[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>  valid_data <span class="ot">&lt;-</span> data[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>, ]</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if there are valid clusters to avoid errors in silhouette calculation</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(valid_clusters)) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a>    silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(valid_clusters, <span class="fu">dist</span>(valid_data))[, <span class="dv">3</span>])</span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign a default low score if there's only one cluster or none</span></span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>    silhouette_score <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> dbscan_result<span class="sc">$</span>cluster, <span class="at">score =</span> silhouette_score))</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform hierarchical clustering</span></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>perform_hclust <span class="ot">&lt;-</span> <span class="cf">function</span>(data, method, k) {</span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>  hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(data), <span class="at">method =</span> method)</span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> k)</span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>  silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(clusters, <span class="fu">dist</span>(data))[, <span class="dv">3</span>])</span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> clusters, <span class="at">score =</span> silhouette_score))</span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each dataframe</span></span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(list_of_dfs)) {</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> list_of_dfs[[i]]</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># K-means</span></span>
<span id="cb55-67"><a href="#cb55-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> k_values) {</span>
<span id="cb55-68"><a href="#cb55-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (method <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Hartigan-Wong"</span>, <span class="st">"Lloyd"</span>, <span class="st">"Forgy"</span>,</span>
<span id="cb55-69"><a href="#cb55-69" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"MacQueen"</span>)) {</span>
<span id="cb55-70"><a href="#cb55-70" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_kmeans</span>(df, k, method)</span>
<span id="cb55-71"><a href="#cb55-71" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>kmeans<span class="sc">$</span>score) {</span>
<span id="cb55-72"><a href="#cb55-72" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>kmeans <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">k =</span> k, <span class="at">method =</span> method)</span>
<span id="cb55-73"><a href="#cb55-73" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb55-74"><a href="#cb55-74" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-75"><a href="#cb55-75" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-76"><a href="#cb55-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-77"><a href="#cb55-77" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DBSCAN</span></span>
<span id="cb55-78"><a href="#cb55-78" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eps <span class="cf">in</span> eps_values) {</span>
<span id="cb55-79"><a href="#cb55-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (minPts <span class="cf">in</span> minPts_values) {</span>
<span id="cb55-80"><a href="#cb55-80" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_dbscan</span>(df, eps, minPts)</span>
<span id="cb55-81"><a href="#cb55-81" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>dbscan<span class="sc">$</span>score) {</span>
<span id="cb55-82"><a href="#cb55-82" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>dbscan <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">eps =</span> eps, <span class="at">minPts =</span> minPts)</span>
<span id="cb55-83"><a href="#cb55-83" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb55-84"><a href="#cb55-84" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-85"><a href="#cb55-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-86"><a href="#cb55-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-87"><a href="#cb55-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical Clustering</span></span>
<span id="cb55-88"><a href="#cb55-88" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> hclust_methods) {</span>
<span id="cb55-89"><a href="#cb55-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> k_values) {</span>
<span id="cb55-90"><a href="#cb55-90" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_hclust</span>(df, method, k)</span>
<span id="cb55-91"><a href="#cb55-91" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>hclust<span class="sc">$</span>score) {</span>
<span id="cb55-92"><a href="#cb55-92" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>hclust <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">k =</span> k, <span class="at">method =</span> method)</span>
<span id="cb55-93"><a href="#cb55-93" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb55-94"><a href="#cb55-94" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb55-95"><a href="#cb55-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb55-96"><a href="#cb55-96" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-97"><a href="#cb55-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-98"><a href="#cb55-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Best models</span></span>
<span id="cb55-99"><a href="#cb55-99" aria-hidden="true" tabindex="-1"></a>best_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$kmeans
$kmeans$score
[1] 0.6380355

$kmeans$model
     Pottery_Mound_Pueblo_IV       Kuaua_Pueblo_Pueblo_IV 
                           1                            3 
               Skhul_Layer_B               Fontbregoua_H1 
                           3                            2 
              Fontbregoua_H3              Gran_Dolina_TD6 
                           2                            2 
            El_Mirador_MIR4A                      Krapina 
                           2                            2 
                      AL_333 Unscavenged_human_corpses_WA 
                           2                            1 
  Scavenged_human_corpses_WA     Mapungubwe_leopard_kills 
                           3                            3 
              Leopard_refuse                 Misgrot_Cave 
                           3                            3 
                    Dinaledi 
                           3 

$kmeans$dataframe
[1] 2

$kmeans$k
[1] 3

$kmeans$method
[1] "Hartigan-Wong"


$dbscan
$dbscan$score
[1] 0.7900363

$dbscan$model
 [1] 0 2 2 1 1 1 1 1 1 0 2 2 2 0 0

$dbscan$dataframe
[1] 2

$dbscan$eps
[1] 0.3

$dbscan$minPts
[1] 5


$hclust
$hclust$score
[1] 0.6380355

$hclust$model
     Pottery_Mound_Pueblo_IV       Kuaua_Pueblo_Pueblo_IV 
                           1                            2 
               Skhul_Layer_B               Fontbregoua_H1 
                           2                            3 
              Fontbregoua_H3              Gran_Dolina_TD6 
                           3                            3 
            El_Mirador_MIR4A                      Krapina 
                           3                            3 
                      AL_333 Unscavenged_human_corpses_WA 
                           3                            1 
  Scavenged_human_corpses_WA     Mapungubwe_leopard_kills 
                           2                            2 
              Leopard_refuse                 Misgrot_Cave 
                           2                            2 
                    Dinaledi 
                           2 

$hclust$dataframe
[1] 2

$hclust$k
[1] 3

$hclust$method
[1] "ward.D"</code></pre>
</div>
</div>
</section>
</section>
<section id="multivar." class="level1">
<h1>Multivar.</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- read.csv('../Input/DATA/Summary_Dataset_Multivar_Percentage_MAU.csv')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> data_multi  <span class="co">#preprocess(data)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 38
Columns: 25
$ Type                                  &lt;chr&gt; "Primary hominin interment", "Pr…
$ AccumulationType                      &lt;chr&gt; "Burial", "Burial", "Burial", "B…
$ Individuals                           &lt;int&gt; 6, 49, 84, 1, 2, 6, 2, 1, 1, 1, …
$ Cranium                               &lt;dbl&gt; 1.0000000, 0.7755102, 0.8095238,…
$ Mandible                              &lt;dbl&gt; 1.0000000, 0.6938776, 0.7619048,…
$ Cervical                              &lt;dbl&gt; 0.71428571, 0.74052478, 0.489795…
$ Thoracic                              &lt;dbl&gt; 0.95833333, 0.76870748, 0.529761…
$ Lumbar                                &lt;dbl&gt; 0.83333333, 0.78775510, 0.600000…
$ Sacrum                                &lt;dbl&gt; 1.0000000, 0.7959184, 0.6190476,…
$ Sternum                               &lt;dbl&gt; 1.00000000, 0.00000000, 0.000000…
$ Clavicle                              &lt;dbl&gt; 1.0000000, 0.8265306, 0.6130952,…
$ Rib                                   &lt;dbl&gt; 0.95833333, 0.76615646, 0.492559…
$ Scapula                               &lt;dbl&gt; 1.00000000, 0.79591837, 0.625000…
$ Humerus                               &lt;dbl&gt; 1.0000000, 0.7448980, 0.7678571,…
$ Radius                                &lt;dbl&gt; 1.00000000, 0.78571429, 0.720238…
$ Ulna                                  &lt;dbl&gt; 1.00000000, 0.75510204, 0.648809…
$ Carpal                                &lt;dbl&gt; 0.729166667, 0.663265306, 0.2886…
$ Innominate                            &lt;dbl&gt; 1.00000000, 0.78571429, 0.714285…
$ Femur                                 &lt;dbl&gt; 1.0000000, 0.8775510, 0.7916667,…
$ Patella                               &lt;dbl&gt; 0.91666667, 0.69387755, 0.458333…
$ Tibia                                 &lt;dbl&gt; 1.0000000, 0.6734694, 0.7202381,…
$ Fibula                                &lt;dbl&gt; 1.0000000, 0.6938776, 0.6190476,…
$ Tarsal                                &lt;dbl&gt; 0.86904762, 0.63265306, 0.486394…
$ Hand..metacarpals...manual.phalanges. &lt;dbl&gt; 0.802631579, 0.658968851, 0.3737…
$ Foot..metatarsals...pedal.phalanges.  &lt;dbl&gt; 0.258771930, 0.436627282, 0.2728…</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Hummingbird_Pueblo_Pueblo_I"     "Pottery_Mound_Pueblo_IV"        
 [3] "Kuaua_Pueblo_Pueblo_IV"          "Dolni_Vestonice_I_DV_3"         
 [5] "Dolni_Vestonice_IITriple_Burial" "Skhul_Layer_B"                  
 [7] "Qafzeh_Couche_XVII"              "Regourdou"                      
 [9] "La_Chapelle_aux_Saints"          "Tabun_Layer_C"                  
[11] "Shanidar_Layer_D_Upper"          "Shanidar_Layer_D_Lower"         
[13] "Kebara_Couche_XII"               "Fontbregoua_H1"                 
[15] "Fontbregoua_H3"                  "Gran_Dolina_TD6"                
[17] "El_Mirador_MIR4A"                "Gough's_Cave"                   
[19] "5MT_3"                           "5MT_10010_Feature_3"            
[21] "El_Miron"                        "La_Tolita_Cama_de_Huesos"       
[23] "Crow_Creek"                      "Krapina"                        
[25] "Liang_Bua_Layer_R"               "Liang_Bua_Layer_OQ"             
[27] "Dmanisi_Layer_B1y"               "Malapa"                         
[29] "AL_333"                          "Unscavenged_human_corpses_WA"   
[31] "Scavenged_human_corpses_WA"      "Scavenged_human_corpses_NM"     
[33] "Scavenged_human_corpse_NC"       "Mapungubwe_leopard_kills"       
[35] "Leopard_refuse"                  "Misgrot_Cave"                   
[37] "Sima_de_los_Huesos"              "Dinaledi"                       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the columns for which you want to count the labels</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>columns_to_count <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to count labels in each specified column</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>count_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(data, columns) {</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(data[columns], <span class="cf">function</span>(column) <span class="fu">table</span>(column))</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the function to count labels</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>label_counts <span class="ot">&lt;-</span> <span class="fu">count_labels</span>(data, columns_to_count)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the counts</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>label_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$Type
column
Hominin cannibalism/ secondary interment 
                                      10 
                          Leopard refuse 
                                       2 
             Natural Baboon accumulation 
                                       1 
   Nonanthropogenic hominin accumulation 
                                       5 
    Possible hominin deliberate disposal 
                                       2 
      Possible Primary hominin interment 
                                       9 
               Primary hominin interment 
                                       5 
                 Scavenged human corpses 
                                       3 
               Unscavenged human corpses 
                                       1 

$AccumulationType
column
                               Burial                Cannibalism/Mass Grave 
                                   16                                    10 
               Carnivore intervention Non-human/ non-carnivore intervention 
                                    5                                     7 

$Individuals
column
  1   2   3   4   5   6   7   8  10  11  13  17  18  43  45  49  84 476 
  8   4   2   2   2   4   4   1   1   1   2   1   1   1   1   1   1   1 </code></pre>
</div>
</div>
<section id="take-sh-out-of-the-training-set-to-avoid-data-leakage-1" class="level3">
<h3 class="anchored" data-anchor-id="take-sh-out-of-the-training-set-to-avoid-data-leakage-1">Take SH out of the training set (to avoid data leakage)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>split <span class="ot">&lt;-</span> <span class="fu">split_train_SH</span>(data)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> split<span class="sc">$</span>train_data</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>sh <span class="ot">&lt;-</span> split<span class="sc">$</span>sh_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="center-and-scale-numeric-data-1" class="level3">
<h3 class="anchored" data-anchor-id="center-and-scale-numeric-data-1">Center and scale numeric data</h3>
<p>Normalize numeric data to have a standard deviation of one and a mean of zero.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store original row names of the datasets</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>data_row_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>sh_row_names <span class="ot">&lt;-</span> <span class="fu">rownames</span>(sh)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Create a recipe</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(<span class="sc">~</span> ., <span class="at">data =</span> data) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>(), <span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>)))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Fit the recipe to the training set</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>fitted_recipe <span class="ot">&lt;-</span> <span class="fu">prep</span>(recipe, <span class="at">training =</span> data)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Apply the transformation to both training and test sets</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>data_transformed <span class="ot">&lt;-</span> <span class="fu">bake</span>(fitted_recipe, <span class="at">new_data =</span> data)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>sh_transformed <span class="ot">&lt;-</span> <span class="fu">bake</span>(fitted_recipe, <span class="at">new_data =</span> sh)</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Reattach the row names</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_transformed) <span class="ot">&lt;-</span> data_row_names</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sh_transformed) <span class="ot">&lt;-</span> sh_row_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="feature-selection-1" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection-1">Feature selection</h3>
<p><strong>In Pnas RF with labels has been used (!data leakage).</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure reproducibility</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the label and features</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> data<span class="sc">$</span>Type</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>data_rf_sup <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>))</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'Type' to a factor</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>label <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>Type)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the RandomForest model</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>rf_model_sup <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(<span class="at">x =</span> data_rf_sup, <span class="at">y =</span> label, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the feature importance</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>feature_importance_ <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model_sup)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the feature importance</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>feature_importance_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)][]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      MeanDecreaseAccuracy MeanDecreaseGini
Cranium                                         2.52234172        0.8077992
Mandible                                       -0.08134858        0.7075026
Cervical                                        1.51127131        1.3683752
Thoracic                                        4.70390506        1.5330130
Lumbar                                          0.86551778        1.0630595
Sacrum                                          1.62584311        1.2101740
Sternum                                         0.75596032        0.5123317
Clavicle                                        5.41059296        1.4759090
Rib                                             4.63924378        2.2510272
Scapula                                         1.17275707        1.2762808
Humerus                                         2.74496613        1.0597972
Radius                                          2.93645381        1.7795114
Ulna                                            1.77844447        1.1388005
Carpal                                          7.05111378        2.2339447
Innominate                                      3.56176309        1.2351311
Femur                                           3.94614978        1.4046189
Patella                                         2.70260726        1.2970945
Tibia                                           1.08756272        0.8701614
Fibula                                          4.64855002        1.3167271
Tarsal                                          5.75461389        1.7673649
Hand..metacarpals...manual.phalanges.           4.85780146        1.9084836
Foot..metatarsals...pedal.phalanges.            1.87239947        1.2964062</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting MeanDecreaseAccuracy </span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>mean_decrease_accuracy <span class="ot">&lt;-</span> feature_importance_[, <span class="st">"MeanDecreaseAccuracy"</span>]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter features where MeanDecreaseAccuracy is greater than 5</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>important_features_ <span class="ot">&lt;-</span> feature_importance_[mean_decrease_accuracy <span class="sc">&gt;</span> <span class="fl">3.4</span>, ]</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the important features</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      MeanDecreaseAccuracy MeanDecreaseGini
Thoracic                                          4.703905         1.533013
Clavicle                                          5.410593         1.475909
Rib                                               4.639244         2.251027
Carpal                                            7.051114         2.233945
Innominate                                        3.561763         1.235131
Femur                                             3.946150         1.404619
Fibula                                            4.648550         1.316727
Tarsal                                            5.754614         1.767365
Hand..metacarpals...manual.phalanges.             4.857801         1.908484</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save top 7 features</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>columns_rf_sup<span class="ot">&lt;-</span> <span class="fu">rownames</span>(<span class="fu">as.data.frame</span>(important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)]))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>columns_rf_sup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Thoracic"                             
[2] "Clavicle"                             
[3] "Rib"                                  
[4] "Carpal"                               
[5] "Innominate"                           
[6] "Femur"                                
[7] "Fibula"                               
[8] "Tarsal"                               
[9] "Hand..metacarpals...manual.phalanges."</code></pre>
</div>
</div>
<p><strong>Random Forrest feature importance with self-label (without data leakage)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>data_rf <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Type"</span>, <span class="st">"AccumulationType"</span>, <span class="st">"Individuals"</span>))</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create artificial labels where each row is its own class</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>artificial_labels <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(data_rf))</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the data with the artificial labels</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>data_with_labels <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data_rf, artificial_labels)</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Random Forest model</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(artificial_labels <span class="sc">~</span> ., <span class="at">data =</span> data_with_labels, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract feature importance based on Mean Decrease in Gini</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>feature_importance <span class="ot">&lt;-</span> <span class="fu">importance</span>(rf_model) <span class="co"># type = 1 for %IncMSE </span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>feature_importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                         %IncMSE IncNodePurity
Cranium                               -0.8536164      47.05994
Mandible                               0.1147836      83.27266
Cervical                               0.1720416     169.01525
Thoracic                              -1.5768097     126.88578
Lumbar                                -2.6378684     105.20559
Sacrum                                -2.0117334     140.63887
Sternum                                0.3636136      33.92542
Clavicle                               8.4767372     453.01167
Rib                                   -3.7738185     117.36955
Scapula                               -2.7016617      52.04775
Humerus                                1.2859107     160.75890
Radius                                 4.9861642     418.35253
Ulna                                   6.0236238     506.21508
Carpal                                 1.7737543     222.00267
Innominate                            -4.2480884      92.38364
Femur                                  0.1615288     159.55587
Patella                               -1.3916602     121.06640
Tibia                                 -0.9854128      93.63424
Fibula                                -1.0652810      98.71481
Tarsal                                 0.1082180     270.36711
Hand..metacarpals...manual.phalanges.  1.8144172     334.34094
Foot..metatarsals...pedal.phalanges.  -1.1364555     152.27370</code></pre>
</div>
</div>
<p>We are going to use <code>names(featrue_importance[feature_importance &gt; 2])</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting MeanDecreaseAccuracy </span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>mean_decrease_accuracy <span class="ot">&lt;-</span> feature_importance[,<span class="st">"%IncMSE"</span>]</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter features where MeanDecreaseAccuracy is greater than 5</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>important_features_ <span class="ot">&lt;-</span> feature_importance_[mean_decrease_accuracy <span class="sc">&gt;</span> <span class="dv">2</span>, ]</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the important features</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>columns_rf <span class="ot">&lt;-</span> <span class="fu">rownames</span>(important_features_[,<span class="fu">c</span>(<span class="dv">10</span><span class="sc">:</span><span class="dv">11</span>)])</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>columns_rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Clavicle" "Radius"   "Ulna"    </code></pre>
</div>
</div>
<p><strong>Unsupervised Feature Selection with Random Forests (UFSRF)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SHAP</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Todo</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Feature correlation heatmap</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>data_plot_cor <span class="ot">=</span> <span class="fu">abbreviated_columns_multi</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data_plot_cor[<span class="fu">sapply</span>(data_plot_cor, is.numeric)], <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>melted_cor_matrix <span class="ot">&lt;-</span> <span class="fu">melt</span>(cor_matrix)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(melted_cor_matrix, <span class="fu">aes</span>(Var1, Var2, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">midpoint =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) + # Rotate x-axis labels</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#theme_minimal() +</span></span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlation Matrix"</span>, <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="co">#correlation matrix</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">method =</span> <span class="st">"color"</span>, <span class="co">#show coloured blocks</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">is.corr =</span> <span class="cn">TRUE</span>, <span class="co">#input matrix is a correlation matrix</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"upper"</span>, <span class="co">#show only upper diagonal of correlogram</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"AOE"</span>, <span class="co">#Hierarchical clustering order</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hclust.method =</span> <span class="st">"average"</span>, <span class="co">#using the average linkage distance measure</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="co">#show numerical value of coefficient</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co">#text color of data label</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of data label</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rect.lwd =</span> <span class="dv">3</span>,<span class="co">#text size of data label</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.srt =</span> <span class="dv">90</span>, <span class="co">#text rotation of data label</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="co">#text size of color-legend label</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of correlation coefficient</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="co">#hide coefficient on the principal diagonal</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="co">#correlation matrix</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">method =</span> <span class="st">"color"</span>, <span class="co">#show coloured blocks</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">is.corr =</span> <span class="cn">TRUE</span>, <span class="co">#input matrix is a correlation matrix</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">"upper"</span>, <span class="co">#show only upper diagonal of correlogram</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="co">#Hierarchical clustering order</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">hclust.method =</span> <span class="st">"average"</span>, <span class="co">#using the average linkage distance measure</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="co">#show numerical value of coefficient</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.col =</span> <span class="st">"black"</span>, <span class="co">#text color of data label</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of data label</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rect.lwd =</span> <span class="dv">3</span>,<span class="co">#text size of data label</span></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.srt =</span> <span class="dv">90</span>, <span class="co">#text rotation of data label</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">cl.cex =</span> <span class="dv">1</span>, <span class="co">#text size of color-legend label</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">number.cex =</span> <span class="fl">0.5</span>, <span class="co">#text size of correlation coefficient</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="co">#hide coefficient on the principal diagonal</span></span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Based on feature correlation and clustering, merge bone subcategories into its categories:</strong></p>
<ul>
<li><p><em>“Vertebra”= {“Cervical”, “Thoracic”, “Lumbar”, “Sacrum”,“Rib”}</em></p></li>
<li><p><em>“Arm” = {“Humerus”, “Radius”, “Ulna”}</em></p></li>
<li><p><em>“Leg” = {“Femur”, “Tibia”, “Fibula” }</em></p></li>
<li><p><em>“Extremities”: {“Carpal”, “Tarsal</em>”, “Hand..metacarpals…manual.phalanges.”, “Foot..metatarsals…pedal.phal</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Define data_cor data set</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>data_cor <span class="ot">=</span> <span class="fu">merge_bone_cat_by_mean</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Define list of data sets to work with:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data, data[columns_rf_sup] , data[columns_rf], data_cor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dimension-reduction-1" class="level3">
<h3 class="anchored" data-anchor-id="dimension-reduction-1">Dimension Reduction</h3>
<p><strong>PCA</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PCA</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>data_pca <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(columns_to_count))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(data_pca, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>X_pca <span class="ot">&lt;-</span> pca_result<span class="sc">$</span>x[,<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>X_pca</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                        PC1          PC2         PC3
Hummingbird_Pueblo_Pueblo_I     -6.26317879 -0.320029809 -0.20637458
Pottery_Mound_Pueblo_IV         -3.46053250 -0.341519848 -1.24262554
Kuaua_Pueblo_Pueblo_IV          -1.47223558  0.104076543  0.02463646
Dolni_Vestonice_I_DV_3          -5.64964375 -0.566569951 -0.45692040
Dolni_Vestonice_IITriple_Burial -5.30490604 -1.026545060  0.54731019
Skhul_Layer_B                    0.06259373  0.040342934  1.34992192
Qafzeh_Couche_XVII              -2.87764706  2.883921727 -0.17493665
Regourdou                       -3.59991607 -2.252717617 -1.20648644
La_Chapelle_aux_Saints          -2.99202091 -0.591248542  0.76900083
Tabun_Layer_C                   -2.72465305  2.067379059  2.01500293
Shanidar_Layer_D_Upper          -1.96247497  1.223255613  0.19064527
Shanidar_Layer_D_Lower           0.39753093  0.168516729  0.33402056
Kebara_Couche_XII               -4.02401790 -4.889692557 -0.37561118
Fontbregoua_H1                   4.48737338  0.020846225 -0.09667296
Fontbregoua_H3                   4.08507105 -0.440508594  0.89125408
Gran_Dolina_TD6                  4.19439527 -0.873493275 -1.14162158
El_Mirador_MIR4A                 4.64367684  0.079903147 -0.18288674
Gough's_Cave                     0.92754114 -0.456272858  2.29031395
5MT_3                            2.90828608 -0.177352598 -0.57699858
5MT_10010_Feature_3              0.84122164 -0.808638096 -0.07707210
El_Miron                        -0.64398800  1.934126246 -4.15994239
La_Tolita_Cama_de_Huesos         1.38811463  0.914110426  1.70221765
Crow_Creek                       1.19704337 -0.487656339  0.26217967
Krapina                          4.93610728 -0.418012389 -0.66216706
Liang_Bua_Layer_R                2.56046707  1.310927542 -0.08385356
Liang_Bua_Layer_OQ               6.03808819 -1.084174068 -1.07369490
Dmanisi_Layer_B1y                4.83659534  0.127247976 -0.60458202
Malapa                          -1.45878129  0.614354380  1.07095513
AL_333                           5.16730056 -0.384303204 -0.46063482
Unscavenged_human_corpses_WA    -5.78599938 -0.613141479 -0.72923300
Scavenged_human_corpses_WA      -1.73450282 -0.520784121 -0.71662546
Scavenged_human_corpses_NM       1.89463764  0.130865192  0.19477716
Scavenged_human_corpse_NC       -3.79314818  3.908920361 -1.52867413
Mapungubwe_leopard_kills        -1.17174467 -0.001577161  1.54042039
Leopard_refuse                  -0.23560018  0.988415687  2.00288836
Misgrot_Cave                     1.24755293 -0.460578797  0.66035639
Dinaledi                         3.34139406  0.197606577 -0.08828686
                                        PC4         PC5        PC6
Hummingbird_Pueblo_Pueblo_I     -1.20307669  0.02419989  0.1381056
Pottery_Mound_Pueblo_IV          0.05209118  0.35194585  1.5493218
Kuaua_Pueblo_Pueblo_IV           0.53867719  0.27789869  0.6616043
Dolni_Vestonice_I_DV_3           1.21205451  0.15138434  0.2853252
Dolni_Vestonice_IITriple_Burial  1.18994706  0.35897512 -1.7183274
Skhul_Layer_B                   -0.11848682  0.17383586 -0.1579496
Qafzeh_Couche_XVII              -2.90311845  0.07511400  2.0184885
Regourdou                       -1.77531862  3.09210814 -1.4355891
La_Chapelle_aux_Saints           2.36284095  0.86298120 -0.3741919
Tabun_Layer_C                   -2.47673302 -0.64867075 -0.7190700
Shanidar_Layer_D_Upper           0.98359008  0.22458109  0.1172693
Shanidar_Layer_D_Lower           0.28197200 -0.35654922  0.6859672
Kebara_Couche_XII               -1.10313251 -2.27059630  0.3727596
Fontbregoua_H1                   0.01633441 -1.49032928 -0.5512797
Fontbregoua_H3                   0.10882003  2.02895711  1.0087580
Gran_Dolina_TD6                 -0.66308678  0.80271122 -0.5258407
El_Mirador_MIR4A                 0.20534252 -1.43134695 -0.2820343
Gough's_Cave                     0.26682942 -0.46007152 -0.2632049
5MT_3                           -0.74601570  0.29295628 -0.6406399
5MT_10010_Feature_3              0.29838320 -0.82973403  0.8749436
El_Miron                        -0.09993232 -1.55101483 -0.6612350
La_Tolita_Cama_de_Huesos         0.07287200  0.79114048 -0.8019716
Crow_Creek                       1.80076188  0.29881872 -0.4549447
Krapina                          0.12331675  0.41259862  0.2999676
Liang_Bua_Layer_R               -0.94737284  1.30632083 -0.3698211
Liang_Bua_Layer_OQ              -0.32350050  1.22295229  0.6674023
Dmanisi_Layer_B1y                0.07032173 -1.42515939 -0.4373536
Malapa                          -2.42422866 -0.99726590 -2.0257576
AL_333                          -0.34065423  0.53575980  0.2984484
Unscavenged_human_corpses_WA    -0.17839589  0.13195076  1.1578364
Scavenged_human_corpses_WA       0.76358146 -0.56542311 -0.4231099
Scavenged_human_corpses_NM       1.23606193 -0.84398156 -0.6770601
Scavenged_human_corpse_NC        2.23706131  0.44667457 -0.5817417
Mapungubwe_leopard_kills         0.92654786 -0.14366057  0.6963865
Leopard_refuse                   0.39796053 -0.39926089  0.9600784
Misgrot_Cave                     0.49493682 -0.88642869  0.9726558
Dinaledi                        -0.33725179  0.43562812  0.3358044</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot 3D pca</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>df_X_pca <span class="ot">=</span> <span class="fu">as.data.frame</span>(X_pca)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(df_X_pca,<span class="at">x=</span><span class="sc">~</span>PC1,<span class="at">y=</span><span class="sc">~</span>PC2,<span class="at">z=</span><span class="sc">~</span>PC3, <span class="at">color =</span> <span class="sc">~</span>label, <span class="at">type =</span> <span class="st">'scatter3d'</span>, <span class="at">mode =</span> <span class="st">'markers'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in RColorBrewer::brewer.pal(N, "Set2"): n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors

Warning in RColorBrewer::brewer.pal(N, "Set2"): n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors</code></pre>
</div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-d6172dd71ffed9911b46" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d6172dd71ffed9911b46">{"x":{"visdat":{"77383a13367":["function () ","plotlyVisDat"]},"cur_data":"77383a13367","attrs":{"77383a13367":{"x":{},"y":{},"z":{},"mode":"markers","color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[4.4873733847090485,4.0850710533561845,4.1943952724358011,4.6436768434432114,0.92754113689128881,2.9082860754339621,0.84122163677299067,1.3881146260501127,1.1970433674112033,4.9361072821941789],"y":[0.020846224940581193,-0.44050859391927033,-0.87349327462871207,0.079903146752557608,-0.45627285837633458,-0.17735259813388055,-0.80863809604097736,0.91411042586442226,-0.48765633886676596,-0.41801238851159034],"z":[-0.096672960272455533,0.89125408252819727,-1.1416215790815083,-0.18288674279315298,2.2903139540244477,-0.57699857856675307,-0.077072102222334904,1.7022176540917082,0.26217966644059065,-0.66216706378486256],"mode":"markers","type":"scatter3d","name":"Hominin cannibalism/ secondary interment","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-1.1717446714948596,-0.23560017754845669],"y":[-0.0015771613324199463,0.98841568738611241],"z":[1.5404203905212557,2.0028883554490684],"mode":"markers","type":"scatter3d","name":"Leopard refuse","marker":{"color":"rgba(239,150,106,1)","line":{"color":"rgba(239,150,106,1)"}},"textfont":{"color":"rgba(239,150,106,1)"},"error_y":{"color":"rgba(239,150,106,1)"},"error_x":{"color":"rgba(239,150,106,1)"},"line":{"color":"rgba(239,150,106,1)"},"frame":null},{"x":[1.2475529273371684],"y":[-0.46057879695674825],"z":[0.66035639391521028],"mode":"markers","type":"scatter3d","name":"Natural Baboon accumulation","marker":{"color":"rgba(178,156,177,1)","line":{"color":"rgba(178,156,177,1)"}},"textfont":{"color":"rgba(178,156,177,1)"},"error_y":{"color":"rgba(178,156,177,1)"},"error_x":{"color":"rgba(178,156,177,1)"},"line":{"color":"rgba(178,156,177,1)"},"frame":null},{"x":[2.5604670713963209,6.0380881922633201,4.836595343619539,-1.4587812908118618,5.1673005584722995],"y":[1.3109275420557938,-1.0841740677677625,0.1272479755955514,0.61435438027243061,-0.38430320432564746],"z":[-0.0838535618279211,-1.0736948998218687,-0.60458201672317458,1.0709551305858969,-0.46063482189910465],"mode":"markers","type":"scatter3d","name":"Nonanthropogenic hominin accumulation","marker":{"color":"rgba(201,148,198,1)","line":{"color":"rgba(201,148,198,1)"}},"textfont":{"color":"rgba(201,148,198,1)"},"error_y":{"color":"rgba(201,148,198,1)"},"error_x":{"color":"rgba(201,148,198,1)"},"line":{"color":"rgba(201,148,198,1)"},"frame":null},{"x":[3.3413940641350881],"y":[0.19760657732808759],"z":[-0.088286864738201132],"mode":"markers","type":"scatter3d","name":"Possible hominin deliberate disposal","marker":{"color":"rgba(205,180,144,1)","line":{"color":"rgba(205,180,144,1)"}},"textfont":{"color":"rgba(205,180,144,1)"},"error_y":{"color":"rgba(205,180,144,1)"},"error_x":{"color":"rgba(205,180,144,1)"},"line":{"color":"rgba(205,180,144,1)"},"frame":null},{"x":[0.062593728728676468,-2.8776470561038137,-3.5999160676504194,-2.9920209097238737,-2.7246530454760318,-1.9624749663473009,0.3975309273643266,-4.0240178967148248,-0.64398799826902042],"y":[0.040342934105397882,2.8839217268695276,-2.2527176173753856,-0.59124854181588504,2.0673790589192591,1.2232556128984782,0.16851672892589287,-4.8896925574485683,1.9341262461061226],"z":[1.3499219246441581,-0.17493665190104513,-1.2064864376557152,0.7690008340131641,2.0150029337843827,0.19064527483992547,0.33402055782668177,-0.37561117738055272,-4.1599423925353616],"mode":"markers","type":"scatter3d","name":"Possible Primary hominin interment","marker":{"color":"rgba(202,217,72,1)","line":{"color":"rgba(202,217,72,1)"}},"textfont":{"color":"rgba(202,217,72,1)"},"error_y":{"color":"rgba(202,217,72,1)"},"error_x":{"color":"rgba(202,217,72,1)"},"line":{"color":"rgba(202,217,72,1)"},"frame":null},{"x":[-6.2631787947842961,-3.4605325002217615,-1.4722355845712007,-5.6496437528015582,-5.3049060418044816],"y":[-0.32002980939034731,-0.34151984759154935,0.10407654254585395,-0.56656995109001684,-1.0265450596292318],"z":[-0.20637457957867583,-1.2426255416088998,0.024636456522020858,-0.45692039687094682,0.54731018987331048],"mode":"markers","type":"scatter3d","name":"Primary hominin interment","marker":{"color":"rgba(250,212,80,1)","line":{"color":"rgba(250,212,80,1)"}},"textfont":{"color":"rgba(250,212,80,1)"},"error_y":{"color":"rgba(250,212,80,1)"},"error_x":{"color":"rgba(250,212,80,1)"},"line":{"color":"rgba(250,212,80,1)"},"frame":null},{"x":[-1.7345028211738847,1.8946376436143524,-3.7931481756012313],"y":[-0.52078412109143457,0.13086519247230155,3.9089203605674721],"z":[-0.71662546383347847,0.19477716235253625,-1.528674127198792],"mode":"markers","type":"scatter3d","name":"Scavenged human corpses","marker":{"color":"rgba(223,194,152,1)","line":{"color":"rgba(223,194,152,1)"}},"textfont":{"color":"rgba(223,194,152,1)"},"error_y":{"color":"rgba(223,194,152,1)"},"error_x":{"color":"rgba(223,194,152,1)"},"line":{"color":"rgba(223,194,152,1)"},"frame":null},{"x":[-5.7859993845301947],"y":[-0.61314147931331553],"z":[-0.72923300111774658],"mode":"markers","type":"scatter3d","name":"Unscavenged human corpses","marker":{"color":"rgba(179,179,179,1)","line":{"color":"rgba(179,179,179,1)"}},"textfont":{"color":"rgba(179,179,179,1)"},"error_y":{"color":"rgba(179,179,179,1)"},"error_x":{"color":"rgba(179,179,179,1)"},"line":{"color":"rgba(179,179,179,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(data_pca, <span class="at">scale. =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate cumulative variance explained by each component</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>var_explained <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Create a scree plot to visualize the variance explained</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">as.data.frame</span>(var_explained), <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">seq_along</span>(var_explained), <span class="at">y =</span> var_explained)) <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.95</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Number of Principal Components"</span>) <span class="sc">+</span></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Cumulative Variance Explained"</span>) <span class="sc">+</span></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Scree Plot Showing Cumulative Variance Explained by PCA Components"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>LDA</strong></p>
<p>bottom page</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#library(MASS)</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="co"># LDA</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_lda &lt;- setdiff(names(data), c("Type","Individuals", "Cluster_Pnas"))</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data_lda &lt;- data[cols_lda]</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_result &lt;- lda(AccumulationType ~ ., data = data_lda)</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co">#X_lda &lt;- as.data.frame(predict(lda_result, newdata = data_lda)$x)</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 3D scatter </span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_ly(X_lda, x = ~LD1, y = ~LD2, z = ~LD3, color = ~data$AccumulationType, type = 'scatter3d', mode = 'markers')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LDA</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co">#cols_lda &lt;- setdiff(names(data), c("AccumulationType","Individuals", "Cluster_Pnas"))</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co">#data_lda &lt;- data[cols_lda]</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_result &lt;- lda(Type ~ ., data = data_lda)</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="co">#X_lda &lt;- as.data.frame(predict(lda_result, newdata = data_lda)$x)</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a 3D scatter </span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_ly(X_lda, x = ~LD1, y = ~LD2, z = ~LD3, color = ~data$Type, type = 'scatter3d', mode = 'markers')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>amend Dataframe list with X_pca[,c(1:6)] and X_lda</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data, data[, columns_rf_sup], data[, columns_rf]</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#,data_cor, </span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>                    ,X_pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>] </span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#,X_lda</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="best-k-1" class="level3">
<h3 class="anchored" data-anchor-id="best-k-1">Best K</h3>
<p><strong>Ellbow method</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>cols_km <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(data), <span class="fu">c</span>(<span class="st">"Type"</span>,<span class="st">"AccumulationType"</span>,<span class="st">"Individuals"</span>, <span class="st">"Cluster_Pnas"</span>))</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>data_km <span class="ot">&lt;-</span> data[cols_km]</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 models with 1 to 10 clusters</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>kclusts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(k, <span class="sc">~</span> <span class="fu">kmeans</span>(<span class="at">x =</span> data_km, <span class="at">centers =</span> .x, <span class="at">nstart =</span> <span class="dv">20</span>)),</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">glanced =</span> <span class="fu">map</span>(model, glance)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(glanced))</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View results</span></span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>kclusts<span class="sc">%&gt;%</span> </span>
<span id="cb92-16"><a href="#cb92-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> tot.withinss)) <span class="sc">+</span></span>
<span id="cb92-17"><a href="#cb92-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb92-18"><a href="#cb92-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co">#create plot of number of clusters vs total within sum of squares</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(data_km, kmeans, <span class="at">method =</span> <span class="st">"wss"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Silhouette method</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_nbclust</span>(data_km, <span class="at">FUN=</span>kmeans, <span class="at">method =</span> <span class="st">"silhouette"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>gap_stat <span class="ot">&lt;-</span> <span class="fu">clusGap</span>(data_km, <span class="at">FUN =</span> kmeans, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">K.max =</span> <span class="dv">10</span>, <span class="at">B =</span> <span class="dv">50</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_gap_stat</span>(gap_stat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="modeling-1" class="level3">
<h3 class="anchored" data-anchor-id="modeling-1">Modeling</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Perform K-means clustering</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  </span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_km, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)  </span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co"># The cluster assignments are stored in kmeans_result$cluster</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>sub_grp <span class="ot">&lt;-</span> kmeans_result<span class="sc">$</span>cluster</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the clusters</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(<span class="fu">list</span>(<span class="at">data =</span> data_km, <span class="at">cluster =</span> sub_grp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="eval-1" class="level3">
<h3 class="anchored" data-anchor-id="eval-1">Eval</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform K-means clustering on the training set</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>) </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_km, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign test set points to nearest clusters</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>get_nearest_cluster <span class="ot">&lt;-</span> <span class="cf">function</span>(point, centers) {</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">apply</span>(centers, <span class="dv">1</span>, <span class="cf">function</span>(center) <span class="fu">dist</span>(<span class="fu">rbind</span>(center, point)))</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">which.min</span>(distances))</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to each row in the test set</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>cluster_assignments_test <span class="ot">&lt;-</span> <span class="fu">apply</span>(sh, <span class="dv">1</span>, get_nearest_cluster, <span class="at">centers =</span> kmeans_result<span class="sc">$</span>centers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in rbind(center, point): number of columns of result is not a multiple
of vector length (arg 1)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dist(rbind(center, point)): NAs introduced by coercion</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>sh_km <span class="ot">=</span> sh[cols_km] </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the training and test sets for visualization</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>combined_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_km, sh_km)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>combined_clusters <span class="ot">&lt;-</span> <span class="fu">c</span>(kmeans_result<span class="sc">$</span>cluster, cluster_assignments_test)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize with fviz_cluster</span></span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(<span class="fu">list</span>(<span class="at">data =</span> combined_df, <span class="at">cluster =</span> combined_clusters))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="MNAU_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List of dataframes for evaluation</span></span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>list_of_dfs <span class="ot">&lt;-</span> <span class="fu">list</span>(data_km,data[, columns_rf_sup]</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>                    , data[, columns_rf]</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#, data_cor </span></span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co">#,X_lda</span></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>                    ,X_pca[, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of clusters to evaluate for K-means</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a>k_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameters for DBSCAN (example ranges)</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a>eps_values <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)</span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a>minPts_values <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>)</span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters for hierarchical clustering</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a>hclust_methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ward.D"</span>, <span class="st">"single"</span>, <span class="st">"complete"</span>, <span class="st">"average"</span>)</span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a><span class="co"># List to store results and best models</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a>best_models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">kmeans =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>),</span>
<span id="cb105-28"><a href="#cb105-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">dbscan =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>),</span>
<span id="cb105-29"><a href="#cb105-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">hclust =</span> <span class="fu">list</span>(<span class="at">score =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">model =</span> <span class="cn">NULL</span>))</span>
<span id="cb105-30"><a href="#cb105-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-31"><a href="#cb105-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform K-means clustering</span></span>
<span id="cb105-32"><a href="#cb105-32" aria-hidden="true" tabindex="-1"></a>perform_kmeans <span class="ot">&lt;-</span> <span class="cf">function</span>(data, k, method) {</span>
<span id="cb105-33"><a href="#cb105-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb105-34"><a href="#cb105-34" aria-hidden="true" tabindex="-1"></a>  kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>, <span class="at">algorithm =</span> method)</span>
<span id="cb105-35"><a href="#cb105-35" aria-hidden="true" tabindex="-1"></a>  silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(kmeans_result<span class="sc">$</span>cluster, <span class="fu">dist</span>(data))[, <span class="dv">3</span>])</span>
<span id="cb105-36"><a href="#cb105-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> kmeans_result<span class="sc">$</span>cluster, <span class="at">score =</span> silhouette_score))</span>
<span id="cb105-37"><a href="#cb105-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-38"><a href="#cb105-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-39"><a href="#cb105-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform DBSCAN clustering</span></span>
<span id="cb105-40"><a href="#cb105-40" aria-hidden="true" tabindex="-1"></a>perform_dbscan <span class="ot">&lt;-</span> <span class="cf">function</span>(data, eps, minPts) {</span>
<span id="cb105-41"><a href="#cb105-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform DBSCAN clustering</span></span>
<span id="cb105-42"><a href="#cb105-42" aria-hidden="true" tabindex="-1"></a>  dbscan_result <span class="ot">&lt;-</span> dbscan<span class="sc">::</span><span class="fu">dbscan</span>(data, <span class="at">eps =</span> eps, <span class="at">minPts =</span> minPts)</span>
<span id="cb105-43"><a href="#cb105-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-44"><a href="#cb105-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Exclude noise points (cluster = 0) from silhouette score calculation</span></span>
<span id="cb105-45"><a href="#cb105-45" aria-hidden="true" tabindex="-1"></a>  valid_clusters <span class="ot">&lt;-</span> dbscan_result<span class="sc">$</span>cluster[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>]</span>
<span id="cb105-46"><a href="#cb105-46" aria-hidden="true" tabindex="-1"></a>  valid_data <span class="ot">&lt;-</span> data[dbscan_result<span class="sc">$</span>cluster <span class="sc">!=</span> <span class="dv">0</span>, ]</span>
<span id="cb105-47"><a href="#cb105-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-48"><a href="#cb105-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if there are valid clusters to avoid errors in silhouette calculation</span></span>
<span id="cb105-49"><a href="#cb105-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">unique</span>(valid_clusters)) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb105-50"><a href="#cb105-50" aria-hidden="true" tabindex="-1"></a>    silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(valid_clusters, <span class="fu">dist</span>(valid_data))[, <span class="dv">3</span>])</span>
<span id="cb105-51"><a href="#cb105-51" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb105-52"><a href="#cb105-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign a default low score if there's only one cluster or none</span></span>
<span id="cb105-53"><a href="#cb105-53" aria-hidden="true" tabindex="-1"></a>    silhouette_score <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb105-54"><a href="#cb105-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-55"><a href="#cb105-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-56"><a href="#cb105-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> dbscan_result<span class="sc">$</span>cluster, <span class="at">score =</span> silhouette_score))</span>
<span id="cb105-57"><a href="#cb105-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-58"><a href="#cb105-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-59"><a href="#cb105-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-60"><a href="#cb105-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to perform hierarchical clustering</span></span>
<span id="cb105-61"><a href="#cb105-61" aria-hidden="true" tabindex="-1"></a>perform_hclust <span class="ot">&lt;-</span> <span class="cf">function</span>(data, method, k) {</span>
<span id="cb105-62"><a href="#cb105-62" aria-hidden="true" tabindex="-1"></a>  hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">dist</span>(data), <span class="at">method =</span> method)</span>
<span id="cb105-63"><a href="#cb105-63" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc, <span class="at">k =</span> k)</span>
<span id="cb105-64"><a href="#cb105-64" aria-hidden="true" tabindex="-1"></a>  silhouette_score <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">silhouette</span>(clusters, <span class="fu">dist</span>(data))[, <span class="dv">3</span>])</span>
<span id="cb105-65"><a href="#cb105-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">cluster =</span> clusters, <span class="at">score =</span> silhouette_score))</span>
<span id="cb105-66"><a href="#cb105-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb105-67"><a href="#cb105-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-68"><a href="#cb105-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each dataframe</span></span>
<span id="cb105-69"><a href="#cb105-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(list_of_dfs)) {</span>
<span id="cb105-70"><a href="#cb105-70" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> list_of_dfs[[i]]</span>
<span id="cb105-71"><a href="#cb105-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-72"><a href="#cb105-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># K-means</span></span>
<span id="cb105-73"><a href="#cb105-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> k_values) {</span>
<span id="cb105-74"><a href="#cb105-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (method <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"Hartigan-Wong"</span>, <span class="st">"Lloyd"</span>, <span class="st">"Forgy"</span>,</span>
<span id="cb105-75"><a href="#cb105-75" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"MacQueen"</span>)) {</span>
<span id="cb105-76"><a href="#cb105-76" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_kmeans</span>(df, k, method)</span>
<span id="cb105-77"><a href="#cb105-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>kmeans<span class="sc">$</span>score) {</span>
<span id="cb105-78"><a href="#cb105-78" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>kmeans <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">k =</span> k, <span class="at">method =</span> method)</span>
<span id="cb105-79"><a href="#cb105-79" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb105-80"><a href="#cb105-80" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-81"><a href="#cb105-81" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-82"><a href="#cb105-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-83"><a href="#cb105-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># DBSCAN</span></span>
<span id="cb105-84"><a href="#cb105-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (eps <span class="cf">in</span> eps_values) {</span>
<span id="cb105-85"><a href="#cb105-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (minPts <span class="cf">in</span> minPts_values) {</span>
<span id="cb105-86"><a href="#cb105-86" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_dbscan</span>(df, eps, minPts)</span>
<span id="cb105-87"><a href="#cb105-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>dbscan<span class="sc">$</span>score) {</span>
<span id="cb105-88"><a href="#cb105-88" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>dbscan <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">eps =</span> eps, <span class="at">minPts =</span> minPts)</span>
<span id="cb105-89"><a href="#cb105-89" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb105-90"><a href="#cb105-90" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-91"><a href="#cb105-91" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-92"><a href="#cb105-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb105-93"><a href="#cb105-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical Clustering</span></span>
<span id="cb105-94"><a href="#cb105-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> hclust_methods) {</span>
<span id="cb105-95"><a href="#cb105-95" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> k_values) {</span>
<span id="cb105-96"><a href="#cb105-96" aria-hidden="true" tabindex="-1"></a>      result <span class="ot">&lt;-</span> <span class="fu">perform_hclust</span>(df, method, k)</span>
<span id="cb105-97"><a href="#cb105-97" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (result<span class="sc">$</span>score <span class="sc">&gt;</span> best_models<span class="sc">$</span>hclust<span class="sc">$</span>score) {</span>
<span id="cb105-98"><a href="#cb105-98" aria-hidden="true" tabindex="-1"></a>        best_models<span class="sc">$</span>hclust <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">score =</span> result<span class="sc">$</span>score, <span class="at">model =</span> result<span class="sc">$</span>cluster, <span class="at">dataframe =</span> i, <span class="at">k =</span> k, <span class="at">method =</span> method)</span>
<span id="cb105-99"><a href="#cb105-99" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb105-100"><a href="#cb105-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb105-101"><a href="#cb105-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb105-102"><a href="#cb105-102" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations

Warning: did not converge in 10 iterations</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: empty cluster: try a better set of initial centers

Warning: empty cluster: try a better set of initial centers</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: did not converge in 10 iterations</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: empty cluster: try a better set of initial centers

Warning: empty cluster: try a better set of initial centers</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Best models</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>best_models</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$kmeans
$kmeans$score
[1] 0.4212028

$kmeans$model
    Hummingbird_Pueblo_Pueblo_I         Pottery_Mound_Pueblo_IV 
                              1                               1 
         Kuaua_Pueblo_Pueblo_IV          Dolni_Vestonice_I_DV_3 
                              4                               1 
Dolni_Vestonice_IITriple_Burial                   Skhul_Layer_B 
                              1                               4 
             Qafzeh_Couche_XVII                       Regourdou 
                              4                               1 
         La_Chapelle_aux_Saints                   Tabun_Layer_C 
                              4                               1 
         Shanidar_Layer_D_Upper          Shanidar_Layer_D_Lower 
                              4                               4 
              Kebara_Couche_XII                  Fontbregoua_H1 
                              1                               3 
                 Fontbregoua_H3                 Gran_Dolina_TD6 
                              3                               3 
               El_Mirador_MIR4A                    Gough's_Cave 
                              3                               4 
                          5MT_3             5MT_10010_Feature_3 
                              2                               4 
                       El_Miron        La_Tolita_Cama_de_Huesos 
                              3                               3 
                     Crow_Creek                         Krapina 
                              3                               3 
              Liang_Bua_Layer_R              Liang_Bua_Layer_OQ 
                              3                               3 
              Dmanisi_Layer_B1y                          Malapa 
                              3                               2 
                         AL_333    Unscavenged_human_corpses_WA 
                              3                               4 
     Scavenged_human_corpses_WA      Scavenged_human_corpses_NM 
                              2                               3 
      Scavenged_human_corpse_NC        Mapungubwe_leopard_kills 
                              2                               4 
                 Leopard_refuse                    Misgrot_Cave 
                              4                               4 
                       Dinaledi 
                              3 

$kmeans$dataframe
[1] 3

$kmeans$k
[1] 4

$kmeans$method
[1] "Hartigan-Wong"


$dbscan
$dbscan$score
[1] 0.5321361

$dbscan$model
 [1] 1 1 1 1 1 1 1 1 1 1 1 2 1 2 2 2 2 1 2 1 2 2 2 2 2 2 2 1 2 0 1 2 0 0 0 2 2

$dbscan$dataframe
[1] 3

$dbscan$eps
[1] 0.5

$dbscan$minPts
[1] 15


$hclust
$hclust$score
[1] 0.4259014

$hclust$model
    Hummingbird_Pueblo_Pueblo_I         Pottery_Mound_Pueblo_IV 
                              1                               2 
         Kuaua_Pueblo_Pueblo_IV          Dolni_Vestonice_I_DV_3 
                              2                               1 
Dolni_Vestonice_IITriple_Burial                   Skhul_Layer_B 
                              1                               2 
             Qafzeh_Couche_XVII                       Regourdou 
                              2                               1 
         La_Chapelle_aux_Saints                   Tabun_Layer_C 
                              2                               1 
         Shanidar_Layer_D_Upper          Shanidar_Layer_D_Lower 
                              2                               2 
              Kebara_Couche_XII                  Fontbregoua_H1 
                              1                               3 
                 Fontbregoua_H3                 Gran_Dolina_TD6 
                              3                               3 
               El_Mirador_MIR4A                    Gough's_Cave 
                              3                               2 
                          5MT_3             5MT_10010_Feature_3 
                              3                               2 
                       El_Miron        La_Tolita_Cama_de_Huesos 
                              3                               3 
                     Crow_Creek                         Krapina 
                              3                               3 
              Liang_Bua_Layer_R              Liang_Bua_Layer_OQ 
                              3                               3 
              Dmanisi_Layer_B1y                          Malapa 
                              3                               4 
                         AL_333    Unscavenged_human_corpses_WA 
                              3                               2 
     Scavenged_human_corpses_WA      Scavenged_human_corpses_NM 
                              3                               3 
      Scavenged_human_corpse_NC        Mapungubwe_leopard_kills 
                              4                               2 
                 Leopard_refuse                    Misgrot_Cave 
                              2                               3 
                       Dinaledi 
                              3 

$hclust$dataframe
[1] 3

$hclust$k
[1] 4

$hclust$method
[1] "average"</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>